# Flutter 项目规则（高阶）

本文档定义本项目的通用工程规范和最佳实践，确保代码质量、性能和可维护性。
本规则文件不包含具体的第三方库、工具、类名或方法名，这些内容在 `TECH_STACK.md` 中定义。
Agent 在实现任务前，必须同时加载本文件和 `TECH_STACK.md`。

---

## 1. 版本与平台

- Flutter SDK：按项目 `pubspec.yaml` 中定义的版本
- Dart SDK：按项目 `pubspec.yaml` 中定义的版本
- 支持平台：Android、iOS

---

## 2. 目录结构

所有新文件必须遵循现有目录结构，保持模块边界清晰：

```text
assets/           # 静态资源
docs/             # 项目文档
lib/
  app/            # 应用入口
  components/     # 通用组件
  config/         # 配置与常量
  core/           # 核心业务、数据层
  generated/      # 自动生成代码
  l10n/           # 翻译文件
  router/         # 路由定义
  src/            # UI、状态、模型、网络等
  utils/          # 工具方法
test/             # 测试代码
```

---

## 3. 模块职责

- **路由**：集中管理路由路径与参数，跳转逻辑必须通过统一路由注册器处理。
- **状态管理**：每个页面有唯一的状态持有者（ViewModel 等），负责状态转换与通知。
- **网络**：所有请求必须通过统一 HTTP 客户端实现，支持超时与错误处理。
- **Repository**：业务数据的单一来源，负责数据源整合与模型转换。
- **服务（Service）**：封装无状态的外部 API 调用逻辑。
- **组件（Widget）**：公共组件应独立封装并复用，禁止在页面中直接实现复杂 UI 逻辑。

---

## 4. 注释与文档

- 公共 API 必须有 `///` 文档注释。
- 注释需描述用途、参数约束、返回值、异常。
- 复杂组件可附带简短使用示例。

---

## 5. 测试规范

- 所有关键功能必须有单元测试或集成测试。
- 测试框架与 Mock 工具在 `TECH_STACK.md` 中定义。
- 测试不通过时，依次检查：

  1. 测试用例是否正确
  2. 业务逻辑是否正确
  3. 依赖库是否正常

---

## 6. 依赖管理

- 优先官方维护、活跃、稳定的依赖包。
- 禁止引入 alpha/beta 版本。
- 固定依赖版本号，并在 `pubspec.yaml` 中添加用途说明。

---

## 7. 编码规范

- 遵循 Dart 官方命名、格式化、类型注解规范。
- 变量/函数命名保持一致性，布尔命名正向表达（如 `isEnabled`）。
- 单文件单一职责。
- 禁止跨模块直接引用内部实现（禁止导入其他模块的 `src` 目录）。

---

## 8. 架构与数据流

- 遵循分层架构（UI / Domain / Data），相邻层直接通信。
- 单向数据流：UI → Domain → Data → Domain → UI
- 状态变更必须通过单一数据源（SSOT）处理。

---

## 9. 性能与可维护性

- 避免在 `build()` 中执行耗时操作。
- 尽可能使用 `const` 构造函数。
- 列表大数据需分页或懒加载。
- 模块化组件以复用和可测试性为目标。

---

## 10. 项目级实现细节

- 本文件不包含具体技术实现。
- 技术选型、代码示例、生成命令等细节请参考 `TECH_STACK.md`。
